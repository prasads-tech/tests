      - name: Commit and Push Manifests
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add ${{ env.OUTPUT_DIR }}/*
          if git diff-index --quiet HEAD --; then
            echo "No changes to commit."
          else
            git commit -m "Generated manifests"
            git push
          fi

      - name: Fetch and Check for Changes
        id: check_files
        run: |
          git fetch origin main
          CHANGED_FILES=$(git diff --name-only HEAD origin/main | grep 'Clusters-Dev/AKS/Workload/')
          if [ -n "$CHANGED_FILES" ]; then
            echo "Changed files detected: $CHANGED_FILES"
            echo "FILES_CHANGED=true" >> $GITHUB_ENV
          else
            echo "No changes detected."
            echo "FILES_CHANGED=false" >> $GITHUB_ENV
          fi

      - name: Create Trigger File if Changes Detected
        if: env.FILES_CHANGED == 'true'
        run: |
          echo "Changes detected. Creating trigger file..."
          mkdir -p .trigger
          touch .trigger/trigger-file.txt
          git add .trigger/trigger-file.txt
          git commit -m "Add trigger file for second workflow"
          git push



name: Scheduled Check for Trigger File

on:
  schedule:
    - cron: '*/30 * * * *'  # Check every 30 minutes
  workflow_dispatch:

jobs:
  check_trigger_file:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check for Trigger File
        id: check_file
        run: |
          if [ -f ".trigger/trigger-file.txt" ]; then
            echo "Trigger file found. Performing actions..."
            echo "TRIGGER_FOUND=true" >> $GITHUB_ENV
          else
            echo "No trigger file found."
            echo "TRIGGER_FOUND=false" >> $GITHUB_ENV
          fi

      - name: Perform Actions
        if: env.TRIGGER_FOUND == 'true'
        run: |
          echo "Performing additional actions based on trigger file..."
          # Insert the commands or scripts you want to run here
          # For example:
          # python scripts/another-script.py
          # Cleanup trigger file after actions
          rm .trigger/trigger-file.txt
          git add .trigger/trigger-file.txt
          git commit -m "Cleanup trigger file after actions"
          git push
