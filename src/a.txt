name: Process JSON Files

on:
  push:
    paths:
      - 'Clusters-Dev/AKS/Workload/Input/*.json'

jobs:
  process-json:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v2

      # Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # Step 3: Find new or modified JSON files
      - name: Find new or modified JSON files
        id: find-json
        run: |
          # Create a variable to hold the paths of new JSON files
          json_files=$(find Clusters-Dev/AKS/Workload/Input/ -name '*.json' -print)
          echo "Found JSON files: $json_files"

          # Check if there are any JSON files
          if [ -z "$json_files" ]; then
            echo "No JSON files found."
            exit 1
          fi

          # Export the file paths to an environment variable
          echo "JSON_FILES=$json_files" >> $GITHUB_ENV

      # Step 4: Install dependencies
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # Step 5: Run the Python script with the JSON files
      - name: Run Python script
        run: |
          # Pass the list of JSON files to the Python script
          python final.py ${{ env.JSON_FILES }}
