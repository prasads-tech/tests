name: Process JSON Files

on:
  push:
    paths:
      - 'Clusters-Dev/AKS/Workload/Input/*.json'

jobs:
  process-json:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v2

      # Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # Step 3: Find JSON files
      - name: Find JSON files
        id: find-json
        run: |
          # Find all JSON files in the directory
          json_files=$(find Clusters-Dev/AKS/Workload/Input/ -name '*.json')

          # Check if there are JSON files
          if [ -z "$json_files" ]; then
            echo "No JSON files found."
            exit 1
          fi

          # Output the file paths to a file
          echo "$json_files" > files.txt

      # Step 4: Install dependencies
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # Step 5: Run Python script with JSON files
      - name: Run Python script
        run: |
          # Read the file paths from files.txt and pass them to the Python script
          while IFS= read -r file; do
            python final.py "$file"
          done < files.txt
