private_key=$(echo "${{ secrets.GITHUB_APP_PRIVATE_KEY }}" | base64 -d)
app_id=$(echo "${{ secrets.GITHUB_APP_ID }}")

if [ -z "$private_key" ] || [ -z "$app_id" ]; then
  echo "Missing GitHub App credentials"
  exit 1
fi



JWT=$(python3 -c '
import jwt
import time
import os

private_key = os.getenv("GITHUB_APP_PRIVATE_KEY")
app_id = os.getenv("GITHUB_APP_ID")

if not private_key or not app_id:
    raise ValueError("Missing environment variables for private key or app ID")

payload = {"iat": int(time.time()), "exp": int(time.time()) + (10 * 60), "iss": app_id}
jwt_token = jwt.encode(payload, private_key, algorithm="RS256")
print(jwt_token)
')

echo "Generated JWT: $JWT"



git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

echo "PR creation response: $PR_RESPONSE"

gh pr create --title "Auto-generated PR for new JSON files" --body "This PR contains changes generated from the new JSON inputs." --base main --head "$BRANCH_NAME"


