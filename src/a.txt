name: Detect and Print New Folder

on:
  push:
    paths:
      - 'Clusters-Dev/AKS/Workload/**'  # This will trigger the workflow for any changes under this path

jobs:
  print-new-folder:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Find and print new folder
        run: |
          # List all the directories in 'Clusters-Dev/AKS/Workload' and store them
          CURRENT_FOLDERS=$(ls Clusters-Dev/AKS/Workload)

          # Get the latest commit that modified 'Clusters-Dev/AKS/Workload'
          LATEST_COMMIT=$(git log -1 --format=format:%H --full-diff Clusters-Dev/AKS/Workload)

          # List directories added in the latest commit
          NEW_FOLDERS=$(git diff-tree --no-commit-id --name-status -r $LATEST_COMMIT | grep 'A' | grep 'Clusters-Dev/AKS/Workload/' | cut -f2 | cut -d'/' -f4)

          if [ -z "$NEW_FOLDERS" ]; then
            echo "No new folders added."
          else
            for FOLDER in $NEW_FOLDERS; do
              echo "New folder detected: $FOLDER"
            done
          fi

- name: Find and print new folder
        run: |
          # Check if this is the first commit
          if [ $(git rev-list --count HEAD) -eq 1 ]; then
            echo "This is the first commit; no previous commits to compare."
          else
            # Get the list of newly added folders
            NEW_FOLDERS=$(git diff --name-only --diff-filter=A HEAD~1 HEAD | grep 'Clusters-Dev/AKS/Workload/' | cut -d'/' -f2 | sort -u)
            
            if [ -z "$NEW_FOLDERS" ]; then
              echo "No new folders added."
            else
              for FOLDER in $NEW_FOLDERS; do
                echo "New folder detected: $FOLDER"
              done
            fi
          fi






- name: Find and print new folder
        run: |
          # Get the list of newly added folders
          NEW_FOLDERS=$(git diff --name-only --diff-filter=A HEAD~1 HEAD | grep 'main-folder/' | cut -d'/' -f2 | sort -u)
          
          if [ -z "$NEW_FOLDERS" ]; then
            echo "No new folders added."
          else
            for FOLDER in $NEW_FOLDERS; do
              echo "New folder detected: $FOLDER"
            done
          fi







name: Trigger Pipeline on Folder Creation

on:
  push:
    paths:
      - 'Clusters-Dev/**' # Adjust the path pattern based on where new folders will be created

jobs:
  detect-new-folder:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Find new folders
        id: find_folders
        run: |
          git fetch origin main
          new_folders=$(git diff --name-status HEAD^ HEAD | grep '^A.*\/$' | awk '{print $2}')
          echo "Found folders: $new_folders"
          echo "new_folders=$new_folders" >> $GITHUB_ENV

      - name: Check if new folders are created
        if: ${{ env.new_folders != '' }}
        run: |
          echo "New folder(s) detected: ${{ env.new_folders }}"

      - name: Parse folder name and run pipeline
        if: ${{ env.new_folders != '' }}
        run: |
          for folder in ${{ env.new_folders }}; do
            folder_name=$(basename $folder)
            echo "Processing folder: $folder_name"
            # Run your pipeline or script here, passing folder_name as an argument or environment variable
            # For example: ./run_pipeline.sh $folder_name
          done
