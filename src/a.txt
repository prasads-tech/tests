name: Process JSON Files

on:
  push:
    paths:
      - 'Clusters-Dev/AKS/Workload/Input/*.json'

jobs:
  process-json:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v2

      # Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # Step 3: Get list of JSON files
      - name: List all JSON files
        id: list-json
        run: |
          # List all JSON files in the directory
          json_files=$(find Clusters-Dev/AKS/Workload/Input/ -name '*.json')
          # Check if there are any files
          if [[ -z "$json_files" ]]; then
            echo "No JSON files found."
            exit 1
          fi
          # Save the JSON files list for later use
          echo "json_files=$json_files" >> $GITHUB_ENV

      # Step 4: Install dependencies
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # Step 5: Run the Python script with the JSON files
      - name: Run Python script
        run: |
          # Execute the script with all found JSON files
          python final.py $json_files
